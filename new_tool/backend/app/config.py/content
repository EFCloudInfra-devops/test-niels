import os, json
from pydantic import BaseModel

class Device(BaseModel):
    name: str
    mgmt_ip: str
    junos: str | None = None
    vc_members: int = 1

class Settings(BaseModel):
    netconf_username: str = os.getenv('NETCONF_USERNAME', 'automation')
    netconf_password: str | None = os.getenv('NETCONF_PASSWORD')
    netconf_key_path: str | None = os.getenv('NETCONF_KEY_PATH')
    netconf_port: int = int(os.getenv('NETCONF_PORT', '830'))
    sync_interval_seconds: int = int(os.getenv('SYNC_INTERVAL_SECONDS', '300'))
    inventory_json: str = os.getenv('INVENTORY_JSON', '{"devices":[]}')

    def inventory(self) -> list[Device]:
        data = json.loads(self.inventory_json)
        return [Device(**d) for d in data.get('devices', [])]

settings = Settings()
DEVICES = {d.name: d for d in settings.inventory()}
